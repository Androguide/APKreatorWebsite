// Generated by CoffeeScript 1.6.3
(function() {
  'use strict';
  angular.module('ngApkreator').controller('SignUpCtrl', function($scope, $http) {
    var hoodie;
    $scope.user = {};
    hoodie = new Hoodie();
    $scope.signUserUp = function(isValid) {
      console.log("signUserUp()", isValid);
      $('.ng-pristine').addClass('ng-invalid');
      if ($scope.user.password === $scope.user.confirm) {
        $scope.user.pwd_error = "";
        $scope.passwordMatch = true;
      } else {
        $scope.user.pwd_error = "Passwords don't match!";
      }
      if (isValid && $scope.user.password === $scope.user.confirm) {
        return hoodie.account.signUp($scope.user.email, $scope.user.password).fail(function(e) {
          console.log("Sign-up Error: ", e);
          switch (e.status) {
            case 409:
              return vex.dialog.alert("The email address " + $scope.user.email + " is already registered.");
          }
        });
      }
    };
    return hoodie.account.on('signup', function(user) {
      console.log("Signed-up: ", user);
      hoodie.store.add("task", {
        firstname: $scope.user.firstname,
        lastname: $scope.user.lastname,
        username: $scope.user.username
      }).done(function(obj) {
        return console.log("success: ", obj);
      }).fail(function(obj) {
        return console.log("fail: ", obj);
      });
      $http.get('http://localhost:5000/confirm_email/' + $scope.user.email).success(function(data) {
        return console.log(data.message);
      }).error(function(data, status) {
        console.log('Error while sending mail: ' + status + ' : ' + data);
        return vex.dialog.alert("Sorry, there was an error (" + status + "). Please try again.");
      });
      return vex.closeAll();
    });
  });

}).call(this);

/*
//@ sourceMappingURL=sign-up.map
*/
